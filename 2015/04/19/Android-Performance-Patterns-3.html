<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="专注 Android 性能优化"><title>Android性能优化典范之Understanding VSYNC | Android Performance</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-50993302-2','auto');ga('send','pageview');
</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android性能优化典范之Understanding VSYNC</h1><a id="logo" href="/.">Android Performance</a><p class="description">True mastery of any skill takes a lifetime</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android性能优化典范之Understanding VSYNC</h1><div class="post-meta">Apr 19, 2015<span> | </span><span class="category"><a href="/categories/Android/">Android</a><a href="/categories/Android/Memory/">Memory</a><a href="/categories/Android/Memory/Performance/">Performance</a></span></div><div class="post-content"><blockquote>
<p>Unbeknown to most developers, there’s a simple hardware design that defines everything about how fast your application can draw things to the screen.</p>
<p>You may have heard the term VSYNC - VSYNC stands for vertical synchronization and it’s an event that happens every time your screen starts to refresh the content it wants to show you.</p>
<p>Effectively, VSYNC is the product of two components Refresh Rate (how fast the hardware can refresh the screen), and Frames Per Second (how fast the GPU can draw images), and in this video +Colt McAnlis walks through each of these topics, and discusses where VSYNC (and the 16ms rendering barrier) comes from, and why it’s critical to understand if you want a silky smooth application.</p>
</blockquote>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>想要开发一个高性能的应用程序,首先你得了解他的硬件工作原理,那么最好的办法就是去使用它,应用程序运行速度的快慢,很容易被人误解为硬件进程的控制问题,然而这最主要的根源在于渲染性能.如果你想要提高你应用程序的渲染性能,你就必须知道什么是<strong>VSYNC</strong>.</p>
<a id="more"></a>
<p>在了解<strong>VSYNC</strong>之前,我们需要了解两个概念:</p>
<h3 id="刷新率"><a href="#刷新率" class="headerlink" title="刷新率"></a>刷新率</h3><p>刷新率代表屏幕在一秒内刷新屏幕的次数,这个值用赫兹来表示,取决于硬件的固定参数. 这个值一般是60Hz,即每16.66ms刷新一次屏幕.</p>
<p><img src="/images/performance-3/1.png" alt="刷新率"></p>
<h3 id="帧速率"><a href="#帧速率" class="headerlink" title="帧速率"></a>帧速率</h3><p>帧速率代表了GPU在一秒内绘制操作的帧数,比如30fps/60fps.在这种情况下,高点的帧速率总是好的.</p>
<p><img src="/images/performance-3/2.png" alt="帧速率"></p>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>刷新率和帧速率需要协同工作,才能让你的应用程序的内容显示到屏幕上,GPU会获取图像数据进行绘制,然后硬件负责把内容呈现到屏幕上,这将在你的应用程序的生命周期中周而复始地发生.下面的图中每一个竖行代表了一帧的绘制和呈现工作.</p>
<p><img src="/images/performance-3/3.png" alt="协同工作"></p>
<p>不幸的是,刷新率和帧速率并不是总能够保持相同的节奏:</p>
<ul>
<li><p>如果帧速率实际上比刷新率快,那么就会出现一些视觉上的问题,下面的图中可以看到,当帧速率在100fps而刷新率只有75Hz的时候,GPU所渲染的图像并非全都被显示出来.</p>
<p><img src="/images/performance-3/4.png" alt="帧速率比刷新率快的情况"></p>
<p>举个例子, 你拍了一张照片,然后旋转5度再拍一张照片, 将两种图片的中间剪开并拼接在一起:</p>
<p><img src="/images/performance-3/5.png" alt="拍两张照片"></p>
<p><img src="/images/performance-3/6.png" alt="剪贴在一起"><br>这两张图有相似之处,但是上面和下面部分有明显的区别,这就叫Tearing(撕裂),是刷新率和帧速率不一致的结果.</p>
<p>上面的原因是因为,当你的显卡正在使用,一个内存区正在写入帧数据(用来显示一帧的一个Buffer),从顶部开始, 新的一帧覆盖前一帧,并立刻输出一行内容. 现在,当屏幕开始刷新时,实际上并不知道缓冲区是什么状态(即不知道缓冲区中的一帧是否绘制完毕,即存在只绘制了一半的情况,另一半还是之前的那帧),因此它从GPU中抓住的帧肯可能并不是完全完整的.</p>
<p><img src="/images/performance-3/7.png" alt="图像撕裂"></p>
<p>目前Android的双缓冲(或者三缓冲/四缓冲), 这是非常有效的,当GPU将一帧写入一个被成为后缓冲的存储器, 而存储器中的次级区域被称为帧缓冲,当写入下一帧时,它会开始填充后缓冲,而帧缓冲保持不变,现在我们刷新屏幕,它将使用帧缓冲(事先已经绘制好),而不是正在处于绘制状态的后缓冲, 这就是VSYNC的作用.如果在屏幕刷新中,VSYNC,即垂直同步,将会在让从后缓冲到帧缓冲的拷贝过程保持同样的复制操作:</p>
<p><img src="/images/performance-3/8.png" alt="Vsync"></p>
<p>GPU的频率比屏幕刷新率高是正常的,因为你的GPU刷新会比屏幕刷新快,在这种情况下,当屏幕刷新成功,你的GPU将会等待VSYNC信号,直到下一个VSYNC信号到来时(即屏幕刷新时),这时你的帧速率就可以达到设备的刷新率上限. 当然这只是理想情况, 当fps达到60的时候,GPU需要在16.66ms内准备好一帧,这对应用程序的要求是非常高的.更不用说100fps了…</p>
</li>
<li><p>屏幕刷新率比帧速率快的情况<br>如果屏幕刷新率比帧速率快,屏幕会在两帧中显示同一个画面,当这种断断续续的情况发生时,你就遇到麻烦了.比如你的帧速率比屏幕刷新率高的时候,用户看到的是非常流畅的画面, 但是帧速率降下来的时候(GPU绘制太多东西的时候),用户将会很明显地察觉到动画卡住了或者掉帧,然后又恢复了流畅.这通常会被描述为闪屏, 跳帧,延迟.</p>
<p><img src="/images/performance-3/9.png" alt="屏幕刷新率比帧速率快"></p>
<p>你的应用程序应该避免这些帧率突降的情况.以确保GPU迅速获取数据,并在屏幕再次刷新之前写录内容.</p>
</li>
</ul>
<h2 id="Perf-Matters"><a href="#Perf-Matters" class="headerlink" title="Perf Matters"></a>Perf Matters</h2><blockquote>
<p>keep calm, profile your code, and always remember, Perf Matters</p>
</blockquote>
<p>博客知识交流不方便，我搞了个<strong>免费</strong> 的知识星期，大家有兴趣的可加进来大家一起讨论，扫描下面的二维码即可加入：</p>
<p><img src="/images/media/591520762002_.pic.jpg" alt="591520762002_.pi"></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://androidperformance.com/2015/04/19/Android-Performance-Patterns-3.html" data-id="cjfhpf3iy000k60zeobo19kjz" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACuklEQVR42u3aUW7jMAwFwN7/0t0DLOy8J1KLLDD5ChLH1qgAxZL8+Ylfvw+vp2v+/vzpmqdv369cfuHh4eEtLT158OT69y1437j8znh4eHj3eE8RNbkmCf2Pj4+fm68HDw8P79t4eTLd5rr5NXh4eHj/Ly8pLrSL/qKDAQ8PD++Vl5dQz8qpeQE3/3a51oKHh4cX8/LFfc/7K/09PDw8vHFXPW9Z5SWGpKzw/qtitXh4eHgXeHnAzZfVLi4pBLfNMzw8PLzbvK1An7ep2gNgYbAADw8Pb5VXNJPKpWyVcRPeT76LeHh4eAPeGaAN3GdHy/t9ovvj4eHhXeC141Bn4b5tqrUNuVFLDA8PD6/kJYXUrSQ4LyLkpd4Pfww8PDy8y7w8rrYBPQFMWmt1ZRoPDw9vzGvT4jxktyWD/Nti3AoPDw/vAi8PtUmA3iq8Jiv5cDjh4eHhXeZNDoB2aOCsYZY//bHWgoeHh7fEOyuwtsluXoyYNOrW6sd4eHh4AW9r6fn7s5UU24SHh4d3gbcwpbU645Sn43UhGA8PD2+Vlw8QtOl4m6DPNwgPDw/vNi9vceUl2jxprosL8bEU9eXw8PDwBry84ZQ08s8+z1txxfbh4eHhXeZNyqyTBPpsixdGB/Dw8PAGVdBJ62tr3Co/MNpBMTw8PLzbvLx5n7fN2rGD9gA4HL3Cw8PDG/OSn53h8wJHnnYXSDw8PLxrvHYR81Gtrft8OAvw8PDwVnm/5WuSRiewusX1nnzj4eHhXeC1oTZpdOUHwGRbdw8SPDw8vJY3OQzmofxsjKAoKOPh4eFd47XFgsnI1CRZL6oseHh4eF/GOysT5J2p/G51fw8PDw/vn/MmrbKz6xP8WkqNh4eHF/Pa5PgscOdjBG3RIRq6wsPDw1viHf6THx8eeaxOFr3c2cPDw8PreH8A6uBzqLYQ9tkAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/Android/">Android</a><a href="/tags/MAT/">MAT</a><a href="/tags/Performance/">Performance</a><a href="/tags/Memory/">Memory</a></div><div class="post-nav"><a class="pre" href="/2015/04/19/Android-Performance-Patterns-4.html">Android性能优化典范之Profile GPU Rendering</a><a class="next" href="/2015/04/19/Android-Performance-Patterns-2.html">Android性能优化典范之Understanding Overdraw</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zMjY3NC85MjM1"><script>(function(d, s) {
   var j, e = d.getElementsByTagName(s)[0];
   if (typeof LivereTower === 'function') { return; }
   j = d.createElement(s);
   j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
   j.async = true;
   e.parentNode.insertBefore(j, e);
})(document, 'script');
</script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://androidperformance.com"/></form></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Github/">Github</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Memory/">Memory</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Memory/Performance/">Performance</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Performance/">Performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/View/">View</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/性能优化/">性能优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/设计/">设计</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/设计/翻译/">翻译</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/2017/">2017</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/推荐/" style="font-size: 15px;">推荐</a> <a href="/tags/MAT/" style="font-size: 15px;">MAT</a> <a href="/tags/Performance/" style="font-size: 15px;">Performance</a> <a href="/tags/Memory/" style="font-size: 15px;">Memory</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/启动优化/" style="font-size: 15px;">启动优化</a> <a href="/tags/DelayLoad/" style="font-size: 15px;">DelayLoad</a> <a href="/tags/Peroformance/" style="font-size: 15px;">Peroformance</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Systrace/" style="font-size: 15px;">Systrace</a> <a href="/tags/hwui/" style="font-size: 15px;">hwui</a> <a href="/tags/RenderThread/" style="font-size: 15px;">RenderThread</a> <a href="/tags/Menory/" style="font-size: 15px;">Menory</a> <a href="/tags/Nexus/" style="font-size: 15px;">Nexus</a> <a href="/tags/设计规范/" style="font-size: 15px;">设计规范</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Singleton/" style="font-size: 15px;">Singleton</a> <a href="/tags/HashMap/" style="font-size: 15px;">HashMap</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/01/why-60-fps.html">流畅度知识（一）- 为什么是 60 fps ?</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/11/Android_Systrace_0.html">【置顶】Android Performance Tools -- Systrace 系列文章目录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/06/2017年度最推荐.html">2017年度最推荐</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/19/Android-performance-optimization-skills-and-tools.html">Android 性能优化必知必会</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/23/About-work.html">关于 2017</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/05/android-bottom-bar-2.html">Android Bottom navigation 规范二：样式、行为与规格</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/05/android-bottom-bar-1.html">Android Bottom navigation 规范一：使用方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/31/How-to-calculation-android-app-lunch-time.html">Android 中如何计算 App 的启动时间？</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/29/Android应用启动优化-一种DelayLoad的实现和原理-下篇.html">Android应用启动优化:一种DelayLoad的实现和原理(下篇)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/18/Android-app-lunch-optimize-delay-load.html">Android应用启动优化:一种DelayLoad的实现和原理(上篇)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.zhihu.com/people/gracker/activities" title="Zhihu" target="_blank">Zhihu</a><ul></ul><a href="https://github.com/Gracker" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://source.android.google.cn/devices/tech/" title="Android 核心技术" target="_blank">Android 核心技术</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Android Performance.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>