<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  
  <title>Avoiding cold starts on Android</title>
  <meta name="author" content="Gracker">
   <meta name="description" content="专注 Android 性能优化">
  

  <meta property="og:title" content="Avoiding cold starts on Android"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="Performance"/>
 <meta property="og:image" content="undefined"/>
  
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="Performance" type="application/atom+xml">
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>

<body>
  <div id='wx_pic' style='display:none;'><img src='/wx_share.png'/></div>
  <div id="main">
    <div class="behind">
      <div class="back">
        <a href="/" class="black-color"><i class="fa fa-times" aria-hidden="true"></i></a>
      </div>
      <div class="description">
        &nbsp;True mastery of any skill takes a lifetime
      </div>
    </div>
    <div class="container">
      

  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        Avoiding cold starts on Android
    </h1>
  


    </div>
    <div class="meta center">
      
<time datetime="2016-04-19T13:14:10.000Z">
  <i class="fa fa-calendar"></i>&nbsp;
  2016-04-19
</time>






    
    &nbsp;
    <i class="fa fa-tag"></i>&nbsp;
    <a href="/tags/Android/">Android</a>


    </div>
    <hr>
    <div class="picture-container">
      
    </div>
    <p>原文地址：<a href="http://saulmm.github.io/avoding-android-cold-starts" target="_blank" rel="external">http://saulmm.github.io/avoding-android-cold-starts</a><br>原文作者：<a href="http://saulmm.github.io/" target="_blank" rel="external">Saúl Molinero</a></p>
<p>During the last weeks, has been seen in the Android developer community some movement regarding the cold starts, splash screens or launch screens on Android. In this post, I’d like to make clear my opinion of whether they are necessary or not, how to use them and how to go beyond in order to offer the best user experience of onboarding to our users.</p>
<p>The code and the examples shown in this article are available at this Github repository</p>
<p>Splash screens, launch screens &amp; cold starts.<br>With this post, Colt McAnlis, (developer advocate at Google) again opened the discussion regarding the usage of Splash/Launch screens on Android sharing a keynote by Cyril Mottier which, among other things, talks about why we should avoid using Splash Screens on Android, arguing that they hurt the user experience, increase the size of the application, etc.</p>
<a id="more"></a>
<p>In my opinion, users should have the content available as soon as possible, but inevitably, when a user launches an application, Android creates a new process that, during it charge, shows a black/white screen which is built with the application theme, or the theme of the activity that is the entry point.</p>
<p>This load can be increased if our application is complex and overwrites the application object, which is normally used to initialize the analytics, error reporters, etc.</p>
<p>Airbnb shows a white screen in its initialization </p>
<p>Therefore, a black screen is not the best choice for our user. If our application load time is slow, we could use a placeholder to simply fill it by real content, or on the other hand, if our workload is complex, we could show the logo of our application to reinforce the branding.</p>
<p>AliExpress shows its logo in its initialization </p>
<p>Your new friend, windowBackground<br>As we talked about before, the window displayed by the window manager when the process is in the loading state is set up with the application theme. Specifically with the value inside android:windowBackground. As concerns this post by Ian Lake, if we play with this attribute setting a <layer-list> with the color of the background of the main activity over a small bitmap in the center we can achieve the following effect:</layer-list></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">layer-list</span> </span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">android:opacity</span>=<span class="string">"opaque"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@color/grey"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bitmap</span></span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/img_pizza"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>We must keep in mind that to avoid problems, the <layer-list> has to be opaque, android:opacity=”opaque”. And the background of the parent of your activity should be filled with a color in your layout, if not, the <layer-list> shown at the start will remain in your activity.</layer-list></layer-list></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/grey"</span></div><div class="line">    &gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"?colorPrimary"</span></div><div class="line">        <span class="attr">android:elevation</span>=<span class="string">"4dp"</span></div><div class="line">        /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Styling the onboarding of your app<br>Taking advantage of the windowBackground we can enrich the experience of our users. If our application is complex, and will show a unique activity like a login or a choice selector, we could take the same anchor point of the bitmap and animate it to achieve a nice effect.</p>
<p>For example: </p>
<p>This animation, translates an ImageView that contains the same resource of the <layer-list>.</layer-list></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">ViewCompat</span><span class="selector-class">.animate</span>(<span class="selector-tag">logoImageView</span>)</div><div class="line">    <span class="selector-class">.translationY</span>(<span class="selector-tag">-250</span>)</div><div class="line">    <span class="selector-class">.setStartDelay</span>(<span class="selector-tag">STARTUP_DELAY</span>)</div><div class="line">    <span class="selector-class">.setDuration</span>(<span class="selector-tag">ANIM_ITEM_DURATION</span>)<span class="selector-class">.setInterpolator</span>(</div><div class="line">         <span class="selector-tag">new</span> <span class="selector-tag">DecelerateInterpolator</span>(1<span class="selector-class">.2f</span>))<span class="selector-class">.start</span>();</div></pre></td></tr></table></figure>
<p>This ImageView is slightly above of the center of the screen, this could be influenced by system bars, I’ve put a margin top of 12dp which just coincides with the half of the height of the status bar.</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;ImageView</div><div class="line">    android:<span class="built_in">id</span>=<span class="string">"@+id/img_logo"</span></div><div class="line">    android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">    android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">    android:layout_gravity=<span class="string">"center"</span></div><div class="line">    android:layout_marginTop=<span class="string">"12dp"</span></div><div class="line">    android:src=<span class="string">"@drawable/img_face"</span></div><div class="line">    tools:visibility=<span class="string">"gone"</span></div><div class="line">    /&gt;</div></pre></td></tr></table></figure>
<p>Styling with a placeholder<br>With the <layer-list> we can also create a placeholder of theu ui which will take the real content of the main activity, for example, we could emulate a Toolbar by playing with the <layer-list>.</layer-list></layer-list></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">layer-list</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">android:opacity</span>=<span class="string">"opaque"</span></div><div class="line">    &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">shape</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@color/grey"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">        <span class="attr">android:height</span>=<span class="string">"180dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"top"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"?colorPrimary"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>In this case, the second <item> emulates the Toolbar that is displayed in the actual content, even, we could put the same height (less the width of the status bar) and apply some nice animation on the toolbar to provide a better experience to the user.</item></p>
<figure class="highlight pony"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">private void collapseToolbar() &#123;</div><div class="line">    int toolBarHeight;</div><div class="line">    <span class="type">TypedValue</span> tv = <span class="function"><span class="keyword">new</span> <span class="title">TypedValue</span>();</span></div><div class="line">    <span class="title">getTheme</span>().<span class="title">resolveAttribute</span>(android.<span class="type">R</span>.attr.actionBarSize, tv, true);</div><div class="line">    <span class="title">toolBarHeight</span> = <span class="title">TypedValue</span>.<span class="title">complexToDimensionPixelSize</span>(</div><div class="line">        tv.data, getResources().<span class="title">getDisplayMetrics</span>());</div><div class="line"></div><div class="line">    <span class="title">ValueAnimator</span> <span class="title">valueHeightAnimator</span> = <span class="title">ValueAnimator</span></div><div class="line">        .<span class="title">ofInt</span>(mContentViewHeight, toolBarHeight);</div><div class="line"></div><div class="line">    <span class="title">valueHeightAnimator</span>.<span class="title">addUpdateListener</span>(</div><div class="line">        new <span class="type">ValueAnimator</span>.<span class="type">AnimatorUpdateListener</span>() &#123;</div><div class="line"></div><div class="line">        @<span class="title">Override</span></div><div class="line">        <span class="title">public</span> <span class="title">void</span> <span class="title">onAnimationUpdate</span>(<span class="type">ValueAnimator</span> animation) &#123;</div><div class="line">            <span class="title">ViewGroup</span>.<span class="title">LayoutParams</span> <span class="title">lp</span> = <span class="title">mToolbar</span>.<span class="title">getLayoutParams</span>();</div><div class="line">            <span class="title">lp</span>.<span class="title">height</span> = (<span class="type">Integer</span>) <span class="title">animation</span>.<span class="title">getAnimatedValue</span>();</div><div class="line">            <span class="title">mToolbar</span>.<span class="title">setLayoutParams</span>(lp);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="title">valueHeightAnimator</span>.<span class="title">start</span>();</div><div class="line">    <span class="title">valueHeightAnimator</span>.<span class="title">addListener</span>(</div><div class="line">        new <span class="type">AnimatorListenerAdapter</span>() &#123;</div><div class="line"></div><div class="line">        @<span class="title">Override</span></div><div class="line">        <span class="title">public</span> <span class="title">void</span> <span class="title">onAnimationEnd</span>(<span class="type">Animator</span> animation) &#123;</div><div class="line">            <span class="title">super</span>.<span class="title">onAnimationEnd</span>(animation);</div><div class="line"></div><div class="line">            <span class="comment">// Fire recycler animator</span></div><div class="line">            <span class="title">mAdapter</span>.<span class="title">addAll</span>(<span class="type">ModelItem</span>.getFakeItems());</div><div class="line"></div><div class="line">            <span class="comment">// Animate fab</span></div><div class="line">            <span class="title">ViewCompat</span>.<span class="title">animate</span>(mFab).<span class="title">setStartDelay</span>(<span class="number">600</span>)</div><div class="line">                .<span class="title">setDuration</span>(<span class="number">400</span>).<span class="title">scaleY</span>(<span class="number">1</span>).<span class="title">scaleX</span>(<span class="number">1</span>).<span class="title">start</span>();</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h1><blockquote>
<p>onboarding-examples - Github<br>Uber onboarding<br>Use cold start time effectively with a branded launch theme - Ian Lake<br>Splash Screens Are Evil, Don’t Use Them! - Cyril Mottier<br>Launch screens - Material Design Spec<br>Launch screens - MaterialDoc, Gonzalo Toledano</p>
</blockquote>


  </article>
  </script>
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <div class="busuanzi center">
    页阅读量:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    站访问量:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    站访客数:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>




    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot container">
    <div class="firstrow">
        <a href="#top" >
        <i class="fa fa-arrow-right"></i>
        </a>
        © XXX 2015-2016
    </div>
    <div class="secondrow">
        <a href="https://github.com/gaoryrt/hexo-theme-pln">
        Theme Pln
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.js"></script>
<script type="text/javascript">

// comments below to disable loading animation
function revealOnScroll() {
  var scrolled = $(window).scrollTop();
  $(".excerpt, .index-title, .index-meta, p").each(function() {
    var current = $(this),
      height = $(window).outerHeight(),
      offsetTop = current.offset().top;
    (scrolled + height + 50 > offsetTop) ? current.addClass("animation"):'';
  });
}
$(window).on("scroll", revealOnScroll);
$(document).ready(revealOnScroll)

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

// back to top scripts
$("a[href='#top']").click(function() {
  $("html, body").animate({ scrollTop: 0 }, 500);
  return false;
});


var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
